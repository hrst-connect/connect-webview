<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Connect | Webview</title>
    <link rel="icon" href="data:;base64,=">
  </head>

  <body>
    <div>
      <h1>Connect Webview Example</h1>

      <div>
        <h2>System</h2>
        <h2 id="network-status"></h2>
      </div>

      <div>
        <h2>Resource Pool</h2>
        <p>
          <span id="resource-pool"></span> | 
          <span id="operator-status"></span>
        </p>
        <button type="button" id="button-call">Call</button>  
      </div>

      <div>
        <h2>Navigation</h2>
        <select id="location-list"></select>   
      </div>

      <div>
        <h2>Movement</h2>
        <button type="button" id="button-turn">Turn</button>
        <button type="button" id="button-tilt">Tilt</button>
      </div>

      <div>
        <h2>Speech</h2>
        <button type="button" id="button-speak">Speak</button>
      </div>

    </div>

    <!-- <script src="/index.js"></script>
    <script src="/call.js"></script>
    <script src="/navigate.js"></script> -->
    <script src="js/movement.js"></script>

    <script>
      // -----------------------
      // SYSTEM
      // -----------------------
      // Check and display network status
      const networkStatus = document.querySelector('#network-status');
      window.addEventListener('offline', () => {
        console.log('Offline');
        networkStatus.innerHTML = 'OFFLINE';
      });
      window.addEventListener('online', () => {
        console.log('Online');
        networkStatus.innerHTML = 'ONLINE';
      });

      // -----------------------
      // RESOURCE POOL
      // -----------------------
      // const RESOURCE_POOL_ID = 'FV4ICw4bxD7qRa92qGA1'; // dev
      const RESOURCE_POOL_ID = 'xxUC9cEdWkWKBb9fk4PJ'; // beta

      const buttonCall = document.querySelector('#button-call');
      buttonCall.addEventListener('click', () => {
        if (typeof connect !== 'undefined') {
          connect.call(RESOURCE_POOL_ID);
        }
      });

      // Resource pool status listener
      function onResourcePoolStatusChange(availableOperators) {
        const operatorStatus = document.querySelector('#operator-status');
        if (availableOperators > 0) {
          operatorStatus.innerHTML = `Available (${availableOperators})`;
          operatorStatus.style.color = 'green';
        } else {
          operatorStatus.innerHTML = 'Unavailable';
          operatorStatus.style.color = 'red';
        }
      }

      // Register resource pool status listener
      window.addEventListener('load', () => {
        document.querySelector('#resource-pool').innerHTML = `${RESOURCE_POOL_ID}`;
        if (typeof connect !== 'undefined') {
          connect.addResourcePoolStatusListener('onResourcePoolStatusChange', RESOURCE_POOL_ID);
        }
      });
    
      // -----------------------
      // NAVIGATION
      // -----------------------
      const locationList = document.querySelector('#location-list');
      locationList.addEventListener('change', (event) => {
        const selectedLocation = event.target.value;
        connect.gotoLocation(selectedLocation);
      });

      // Create a list of locations  
      window.addEventListener('load', () => {
        if (typeof connect !== 'undefined') {
          const locations = JSON.parse(connect.getLocations());
          locations.forEach((location) => {
            const option = document.createElement('option');
            option.innerHTML = location;
            locationList.appendChild(option);
          });
        }
      });

      // -----------------------
      // MOVEMENT
      // -----------------------
      const buttonTurn = document.querySelector('#button-turn');
      buttonTurn.addEventListener('click', (event) => {
        if (typeof connect !== 'undefined') {
          connect.turnBy(90); // [degrees]
        }
      });

      const buttonTilt = document.querySelector('#button-tilt');
      buttonTilt.addEventListener('click', (event) => {
        if (typeof connect !== 'undefined') {
          connect.tiltBy(90); // [-25, +55] [degrees]
        }
      });

      // -----------------------
      // SPEECH
      // -----------------------
      const buttonSpeak = document.querySelector('#button-speak');
      buttonSpeak.addEventListener('click', (event) => {
        if (typeof connect !== 'undefined') {
          connect.speak("Hello World");
        }
      });

    </script>
  </body>
</html>
